<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/league.css">
	<link rel="stylesheet" href="css/custom.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/monokai.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section data-background="images/dagen.svg" data-background-size="22%"
				data-background-position="bottom 4% left 4%" data-background-color="white">
				<h2 style="color: black; text-transform: none; font-size: 4em;">Kotlin i Skatteetaten</h2>
				<h2 style="color: black; text-transform: none;">Erfaringer fra fronten</h2>
			</section>

			<section>
				<h2>Agenda</h2>
				<ul>
					<li>Hvem er vi?</li>
					<li>Introduksjon</li>
					<ul>
						<li>Aurora Platformen</li>
					</ul>
					<li>Storyteller</li>
					<li>Gobo</li>
					<li>DSLs</li>
					<li>Hvorfor Kotlin?</li>
				</ul>

				<aside class="notes">
					Jarle
				</aside>
			</section>

			<section>
				<section>
					<h2>Hvem er vi?</h2>
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section>
					<ul>
						<li>Jobber for Systek</li>
						<ul>
							<li>Konsulentfirma i Oslo</li>
							<li>70 ansatte (September 2020)</li>
						</ul>
						<li>Konsulent hos Skatteetaten siden 2018</li>
						<li>Driver Oslo Kotlin Meetup</li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section data-background="images/systek-logo.png" data-background-size="25%"
					data-background-position="bottom 6% left 6%">
					<h2>Jarle Hansen</h2>
					<ul>
						<li><a href="mailto:jarle.hansen@systek.no">jarle.hansen@systek.no</a></li>
						<li><a href="https://github.com/jarlehansen">github.com/jarlehansen</a></li>
					</ul>
				</section>

				<section data-background="images/systek-logo.png" data-background-size="25%"
					data-background-position="bottom 6% left 6%">
					<h2>Anders Mikkelsen</h2>
					<ul>
						<li><a href="mailto:anders.mikkelsen@systek.no">anders.mikkelsen@systek.no</a></li>
						<li><a href="https://github.com/mikand13">github.com/mikand13</a></li>
					</ul>
				</section>
				</ul>
			</section>

			<section>
				<section>
					<h2>Introduksjon</h2>
					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Hva skal vi gå igjennom?</h2>
					<ul>
						<li>Skatteetatens erfaring med bruk av Kotlin</li>
						<li>Noen bruksområder</li>
						<ul>
							<li>GraphQL</li>
							<li>Domain Specific Languages</li>
						</ul>
						<li>Kontakt oss gjerne etter presentasjonen</li>
					</ul>
					<aside class="notes">
						Anders
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Skatteetaten</h2>
					<ul>
						<li>~6500 ansatte - ~500 utviklere</li>
						<li>Skatteberegning og innkreving</li>
						<li>Folkeregisteret</li>
					</ul>

					<aside class="notes">
						Jarle
						NTA is in process of modernizing the systems
						Moving from "classic" to a cloud solution using openshift
						New national registry
					</aside>
				</section>

				<section>
					<h2>Brukere</h2>
					<ul>
						<li>4.9 millioner i 2018, av totalt 5.3 millioner nordmenn</li>
						<li>Integrasjoner med de fleste andre offentlige tjenester</li>
						<li>Integrasjon med firmaer som benytter folkeregisteret</li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Aurora Plattformen</h2>

					<br />
					<br />

					<p><a href="https://skatteetaten.github.io/aurora"
							target="_blank">https://skatteetaten.github.io/aurora</a></p>
					<aside class="notes">
						Jarle
						Aurora is the internal cloud platform in the NTA
					</aside>
				</section>

				<section>
					<h2>PaaS</h2>

					<ul>
						<li>Basert på OpenShift</li>
						<li>Egen konfigurasjon og verktøy</li>
						<li>Bygget med Kotlin og kotlin-gradle</li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section data-background="images/fraggle-rock.jpg" data-background-size="50%">
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section>
					<h2>PaaS</h2>
					<p>Tjenestene har navn fra Fragglene</p>
					<table border="0">
						<tr>
							<td><img src="images/fraggle-gobo.jpg" style="width: 250px" /></td>
							<td><img src="images/Storyteller_Fraggle.png" style="width: 255px" /></td>
						</tr>
						<tr>
							<td style="text-align: center;">Gobo</td>
							<td style="text-align: center;">Storyteller</td>
						</tr>
					</table>


					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section>
					<h2>Aurora github io</h2>
					<p><a href="https://skatteetaten.github.io/aurora"
							target="_blank">https://skatteetaten.github.io/aurora</a></p>
					<img src="images/aurora-platform.png" width="80%" />
					<aside class="notes">
						Jarle
					</aside>
				</section>

			</section>

			<section>
				<section>
					<h2>Storyteller</h2>

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Storyteller</h2>

					<img src="images/Storyteller_Fraggle.png" height="200" width="200">

					<p>Storyteller er en intern tjeneste, som tilbyr automatisk provisjonering og sanering av miljøer
						på tvers av all infrastruktur i Skatteetaten</p>

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>fun facts (2019)</h2>
					<ul>
						<li>OpenShift / VMWare</li>
						<li>~6500 VM'er</li>
						<li>944 pods i produksjon, ~5500 totalt</li>
						<li>Antallet pods øker med ca. 50% hvert år</li>
						<li>~500 microservices i produksjon for hovedtjenester</li>
						<li>Deploys tom. september 2019: 139 659</li>
					</ul>
					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Overview</h2>

					<ul>
						<li>Et miljø er en samling av såkalte segmenter, som er en organisatorisk enhet i Skatteetaten</li>
						<li>Et standard generelt testmiljø kan bestå av:
							<ul>
								<li>100vis av Cores</li>
								<li>1000vis av GB RAM</li>
								<li>X TB mengder lagring</li>
							</ul>
						</li>
						<li>På disse ressursene kjører det forskjellige konstellasjoner av moderiniserte og legacy applikasjoner både på mer tradisjonell infrastruktur og som pods på OpenShift</li>
					</ul>

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Arkitektur</h2>

					<ul>
						<li>Microservices</li>
						<li>Event-Driven</li>
					</ul>

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Arkitektur</h2>

					<img src="images/bonehead_oversikt.png" height="550" width="450">

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>Teknologi</h2>

					<ul>
						<li>Kotlin</li>
						<li>Spring-Boot</li>
						<li>Vert.x</li>
					</ul>

					<aside class="notes">
						Anders

						Will primarily look at Kotlin and Spring-Boot and Kotlin-gradle and how it enables productivity
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Gobo</h2>

					<img src="images/fraggle-gobo.jpg" height="200" width="200">

					<p>GraphQL gateway</p>

					<aside class="notes">
						Anders
					</aside>
				</section>

				<section>
					<h2>GraphQL</h2>
					<ul>
						<li>Query language for your API</li>
						<li>Benytter graphql-kotlin</li>
					</ul>
				</section>

				<section>
					<iframe data-src="https://graphql.org/" data-preload width="350px" height="560px" scrolling="no"></iframe>
				</section>

				<section>
					<h2>graphql-kotlin</h2>
					<p>Kotlin kode genererer GraphQL skjemaet</p>

					<pre><code class="kotlin" data-trim contenteditable style="font-size: 18px;">
	@Component
	class AffiliationQuery(val affiliationService: AffiliationService) : Query {
		suspend fun getAffiliations() = affiliationService.getAffiliations()
	}
					</code></pre>
				</section>

				<section>
					<h2>graphql-kotlin</h2>
					<pre><code class="kotlin" data-trim contenteditable style="font-size: 18px;">
						type Query {
							affiliations: [Affiliation!]!
						}
					</code></pre>
				</section>
			</section>

			<section>
				<section>
					<p style="font-size:1.6em;">DSL i Skatteetaten</p>
					<aside class="notes">
						Jarle
						- Describe internal and external dsl
						- Internal DSL: (depends on host language) a particular form of API in the host general purpose
						language, fluent interface
						- External DSL: (is independent of host language) is parsed independently of the host general
						purpose language
					</aside>
				</section>

				<section>
					<h2>Test data generering</h2>
					<ul>
						<li>Domeneekspertene produserer rike testdata</li>
						<li>Lett for ikke-tekniske ressurser å benytte</li>
					</ul>
					<aside class="notes">
						Jarle
						Number of test scenarios is very high, this is the reason why it needs to be easy and fast to
						create new test cases
					</aside>
				</section>

				<section>
					<h2>Kotlin playground</h2>
					<ul>
						<li><a href="https://play.kotlinlang.org/" target="_blank">https://play.kotlinlang.org/</a></li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section>
					<h2>Kotlin playground</h2>
					<ul>
						<li>Laget en fork av Kotlin playground repo</li>
						<li>Gjorde tilpassninger for å kjøre det i vår interne infrastruktur</li>
						<li>Tilpasset front-end til å følge Skatteetaten kravene for design</li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>

				<section data-background-video="videos/playground.mp4">
					<aside class="notes">
						Jarle
					</aside>
				</section>
			</section>

			<section>
				<h2>Key takeaways</h2>
				<ul>
					<li>Kotlin is great for developer satisfaction - minimal adoption resistance</li>
					<li>Works well with existing libraries, but there are exceptions (such as Threads/coroutines)</li>
					<li>Migrating existing Java applications is a breeze</li>
					<li>Kotlin is a great tool for DSLs and can generally be used for the entire ecosystem</li>
				</ul>
				<aside class="notes">
					Anders
					ASK ABOUT QUESTIONS
					Kotlin is an official language in the NTA, developers can choose between kotlin and java for new
					projects
					Spoiler, they choose kotlin ;)
					Converting Java applications to Kotlin, an example is an application for database management which
					has been continuously converted to kotlin feature-by-feature
				</aside>
			</section>


			<section>
				<section>
					<h2>Why Kotlin?</h2>

					<aside class="notes">
						Jarle
						100% compatibility with Java code.
						Easy to adopt, lots of existing libraries that can be used.
					</aside>
				</section>


				<!--Kodeeksempler -->
				<section>
					<h2>Kotlin language features</h2>
					<ul>
						<li>Dataclasses, named and default arguments</li>
						<li>Collection api</li>
						<li>Extension functions</li>
						<li>NULL safety operator</li>
						<li>when, case on speed</li>
						<li>Reified types</li>
						<li>Useful constructs</li> <!-- runCatching -->
						<li>coroutines</li> <!-- Peke på kotlinconf presentasjon -->
					</ul>
					<aside class="notes">
						Jarle
						Nothing new, but it is worth mentioning
						All of these points provides developer satisfaction
					</aside>
				</section>

				<section>
					<h2>Lessons learned</h2>
					<ul>
						<li>Kotlin creates great developer satisfaction</li>
						<li>Features such as extension functions and null safety helps us avoid bugs/mistakes by
							modifying poor API's</li>
						<li>Certain libraries do not integrate with coroutines, in not so obvious ways</li>
						<li>Thread.local (used by Spring security, log4j etc.) does not work well with coroutines</li>
						<li>Kotlin gradle has unpredictable syntax and can be slow</li>
					</ul>
					<aside class="notes">
						Jarle
					</aside>
				</section>
			</section>

		</div>
	</div>

	<script src="js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true }
			]
		});
	</script>
</body>

</html>